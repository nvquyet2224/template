<!DOCTYPE HTML>
<html lang="vi" class="useFull">

<head>
<style>
	html,body{padding:0;margin:0;width:100%;height:100%;overflow:hidden}
	svg{position:fixed;left:0;top:0}
</style>

<script>
var svgDocument=null;
var O=T=G=null;
var svgns = 'http://www.w3.org/2000/svg';
var xlinkns = 'http://www.w3.org/1999/xlink';
var finalX=new Array();
var finalY=new Array();
var imwi=imhi=0;

Pix=new Array(2,4,5,9,11,17,18,24,28,29,31,33,34,35,38,41,44,45,47,52,55,56,59,61,62,71,72,73,74,75,76,77,78);
Pix=new Array(17,11,2,78,76,74,72,62,56,47,45);

function startup(evt){
	O=evt.target;
	svgDocument=O.ownerDocument;
	svgRoot = svgDocument.documentElement;
	T=svgDocument.getElementById("T");
	M=svgDocument.getElementById("M");
	G=svgDocument.getElementById("G");
	imwi=T.getAttribute("width");
	imhi=T.getAttribute("height");
	
	//Tạo dãy clipPath hình chữ nhật
	carve();
	
	//Tạo clipPath dạng circle
	//carveC();
}


function carveC() {
	buildC(11,275,206);
}

function buildC(id,x,y){
	
	//Background là hình mà mình muốn clipPath
	Background = T.cloneNode("false");
	Background.setAttribute("id", id);
	Background.setAttribute("x", 0); 
	Background.setAttribute("y", 0);
	
	Background.setAttribute("onmousedown","trapC(evt)")
	Background.setAttribute("transform","translate("+(x)+" "+(y)+")")
	
	//Tạo 1 clipPath
	clipPath = svgDocument.createElementNS(svgns,"clipPath");
	clipId="CP"+id;
	clipPath.setAttribute("id",clipId);
	
	//Tạo hình dạng cho clipPath [ mask ]
	circle=svgDocument.createElementNS(svgns,"circle");
	circle.setAttributeNS(null,"fill","none");
	circle.setAttributeNS(null,"stroke","black");
	circle.setAttributeNS(null,"cx",x);
	circle.setAttributeNS(null,"cy",y);
	circle.setAttributeNS(null,"r",150);
		
	//Chèn mask vào clipPath
	clipPath.appendChild(circle);


	//Chèn clipPath vào vùng view
	G.appendChild(clipPath);
			
			
	//Kết nối clipPath với Background mong muốn
	Background.setAttribute("clip-path","url(#"+clipId+")");
		
	G.appendChild(Background);
	
	finalX[id]=x;
	finalY[id]=y;
}


function trapC(evt){
	id=evt.target.id
	//id=evt.currentTarget.id  -- this would be prefered but Opera doesn't seem to recognize it.
	//M.firstChild.nodeValue=id -- this allows us to display the id of the selected object
	x=evt.clientX;
	y=evt.clientY;
	offsetx=x-finalX[id];
	offsety=y-finalY[id];
	G.setAttribute("onmousemove","movingC(evt,'"+id+"',"+offsetx+","+offsety+")")
	G.setAttribute("onmouseup","G.setAttribute('onmousemove',null)")
	o=svgDocument.getElementById(id)
	//f="p"+Pix[Math.floor(Math.random()*Pix.length)]+".jpg"
	f="bg1.jpg"
	o.setAttributeNS(xlinkns,"xlink:href",f)
}

function movingC(e,i,x,y){
	o=svgDocument.getElementById(i)
	o.setAttribute("transform","translate("+(e.clientX - x)+" "+(e.clientY - y)+")")
	finalX[i]=e.clientX - x
	finalY[i]=e.clientY - y
}


rows=5;
cols=4;
count=0;
offsetx=offsety=0

//Tạo dãy clipPath hình chữ nhật
function carve(){
	for (i=0;i<rows;i++){
		for (j=0;j<cols;j++){
			id="I"+(i*cols+j)
			x=Math.ceil(j*imwi/cols)
			y=Math.ceil(i*imhi/rows)
			build(id,x,y)
		}
	}
}

function build(id,x,y){
	OU=T.cloneNode("false")
	OU.setAttribute("id", id);
	OU.setAttribute("x", -x); 
	OU.setAttribute("y", -y); 
	OU.setAttribute("onmousedown","trap(evt)")
	OU.setAttribute("transform","translate("+(x)+" "+(y)+")")
	CP=svgDocument.createElementNS(svgns,"clipPath")
	cid="CP"+id
	CP.setAttribute("id",cid)
	R=svgDocument.createElementNS(svgns,"rect")
	R.setAttribute("x",0)
	R.setAttribute("y",0)
	R.setAttribute("width",Math.ceil(imwi/cols)-1)
	R.setAttribute("height",Math.ceil(imhi/rows)-1)
	CP.appendChild(R)
	G.appendChild(CP);
	OU.setAttribute("clip-path","url(#"+cid+")")
	G.appendChild(OU);
	finalX[id]=x
	finalY[id]=y
	
}

function trap(evt){
	id=evt.target.id
	//id=evt.currentTarget.id  -- this would be prefered but Opera doesn't seem to recognize it.
	//M.firstChild.nodeValue=id -- this allows us to display the id of the selected object
	x=evt.clientX;
	y=evt.clientY;
	offsetx=x-finalX[id]
	offsety=y-finalY[id]
	G.setAttribute("onmousemove","moving(evt,'"+id+"',"+offsetx+","+offsety+")")
	G.setAttribute("onmouseup","G.setAttribute('onmousemove',null)")
	o=svgDocument.getElementById(id)
	//f="p"+Pix[Math.floor(Math.random()*Pix.length)]+".jpg"
	f="p74.jpg"
	o.setAttributeNS(xlinkns,"xlink:href",f)
}

function moving(e,i,x,y){
	o=svgDocument.getElementById(i)
	o.setAttribute("transform","translate("+(e.clientX - x)+" "+(e.clientY - y)+")")
	finalX[i]=e.clientX - x
	finalY[i]=e.clientY - y
}

</script>

</head>

<body>

<svg xmlns="http://www.w3.org/2000/svg" onload="startup(evt)" width="100%" height="100%">
<defs><image id="T" xlink:href='bg1.jpg' width="1920" height="1080" /></defs>
<g id="G"><rect id="bg" x="0" y="0" height="100%" width="100%" fill="#799"/></g>
</svg>

</body>
</html>
