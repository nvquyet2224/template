<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Demo Konva</title>
    <style>
        body, * {
            margin:0;
            padding:0;
        }
    </style>
</head>
<body>
<div id="container"></div>
<script src="https://unpkg.com/konva@7.0.3/konva.min.js"></script>
<!-- <script src="https://unpkg.com/konva@7.2.5/konva.min.js"></script> -->
<script src="https://rawgit.com/konvajs/greensock-plugin/master/KonvaPlugin.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenLite.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TimelineLite.min.js"></script>
<script src="https://www.snorkl.tv/dev/libs/greensock/plugins/ColorPropsPlugin.min.js"></script>

<script>

    function convertPointToPath(points) {
        var p = points.split(/\s+/);
        console.log(p);
        var path = "";
        for( var i = 0; i < p.length; i++ ){
            if(i == 0) {
                path += "M" + p[i];
            } else if(i !=0 && i%2 == 0) {
                path += "L" + p[i];
            }else {
                path += p[i];
            }
        }
        
        path = path.replaceAll(',', ' ');
        console.log(path);
        return path;
    }

    var width = window.innerWidth;
    var height = window.innerHeight;

    var stage = new Konva.Stage({
        container: "container",
        width: width,
        height: height
    });

    var layer = new Konva.Layer();
    /*
    var innerRect = new Konva.Rect({
        x: 100,
        y: 100,
        width: 0,
        height: 30,
        fill: "skyblue",
        cornerRadius: 20
    });

    TweenLite.to(innerRect, 1, {
        konva: {
            width: 300
        }
    });


    var path = new Konva.Path({
        x: 0,
        y: 0,
        data: 'M66 15 L75 100 L225 120 L100 17 L66 15',
        stroke: 'green'
    });


    // get the path length and set this as the dash and dashOffset. 
    var pathLen = path.getLength();
    path.dashOffset(pathLen);
    path.dash([pathLen]);
    
    layer.add(path);

    // create the tween
    TweenLite.to(path, 1.5, {
        konva: {
            dashOffset: 0,
        },
        ease: Power4.easeOut,
    });

    // Line points to path
    var linePath = new Konva.Path({
        x: 23,
        y: 20,
        data: convertPointToPath('5, 70, 140, 23, 250, 60, 300, 20'),
        stroke: 'red',
        strokeWidth: 5
    });

    var lineLen = linePath.getLength();
    linePath.dashOffset(lineLen);
    linePath.dash([lineLen]);

    layer.add(linePath);

    TweenLite.to(linePath, 1.5, {
        konva: {
            dashOffset: 0,
        },
        ease: Power4.easeOut,
    });
    

    // Rectangle and border animation
    var rect = new Konva.Rect({
        x: width/2 - 200,
        y: height/2 - 50,
        width: 100,
        height: 100,
        stroke: 'red',
        strokeWidth: 5,
        cornerRadius: 10,
    });
    
    layer.add(rect);


    // Loading arc
    var arcStroke = new Konva.Arc({
        x: stage.width() / 2,
        y: stage.height() / 2,
        innerRadius: 50,
        outerRadius: 40,
        angle: 360,
        stroke: 'black',
        strokeWidth: 2,
    });
    layer.add(arcStroke);*/

    var arc = new Konva.Arc({
        x: stage.width() / 2,
        y: stage.height() / 2,
        innerRadius: 50,
        outerRadius: 40,
        angle: 0,
        fill: 'yellow'
    });
    layer.add(arc);

   
    //var tl = new TimelineLite();
    // tl.to(arc, 1.5, {
    //     konva: {
    //         angle: 360
    //     },  
    //     ease: Power4.easeOut,
    //     repeat:-1
    // });
    TweenLite.fromTo(arc, 1.5, { 
        konva: { 
            angle: 0
        } 
    }, {   
        konva: { 
            angle: 360 
        },
        repeat:-1,
        //yoyo: true,
        onUpdate: drawLayer,
        onComplete: function(){
            console.log('onComplete');
            layer.draw();
        }
    });


    
    

    // After
    stage.add(layer);
    //layer.batchDraw();
    function drawLayer() {
        console.log('drawLayer');
        layer.draw();
    }

</script>
 
</body>
</html>