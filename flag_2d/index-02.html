<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>PixiJS V4 Displacement Filter Demo - By MarkHawkinsDesigns.com</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.6.2/pixi.min.js"></script>
    <style type="text/css">
        body {
            background-color: #000;
        }
        canvas {
            width: 100%;
            max-width: 600px;
        }
    </style>
</head>

<body>

    <script>

        function Flag2() {
            var size = [600, 400];
            var ratio = size[0] / size[1];
            var stage = new PIXI.Stage(0x333333, true);
            var renderer = PIXI.autoDetectRenderer(size[0], size[1], { antialias: true, transparent: true });

            // our animation speed	
            var speed = 20;
            var delX = speed;
            var delY = speed;


            // Append PixiJS to body		
            document.body.appendChild(renderer.view);

            var stage = new PIXI.Container();

            // get our image background as a texture
            var texture = PIXI.Texture.fromImage('images/flag.png');
            // add it to a sprite
            var image = new PIXI.Sprite(texture);

            // get our displacement map (image)	
            var displacementSprite = PIXI.Sprite.fromImage("images/filters/displacement_map_repeat.jpg");
            // set to repeat in a tiled patern
            displacementSprite.texture.baseTexture.wrapMode = PIXI.WRAP_MODES.REPEAT;

            // set filter to sprite container
            var displacementFilter = new PIXI.filters.DisplacementFilter(displacementSprite);

            // Add our filter and sprites to stage	
            stage.filters = [displacementFilter];
            stage.addChild(displacementSprite);
            stage.addChild(image);

            animate();

            function animate() {
                requestAnimationFrame(animate);
                displacementSprite.x += delX;
                displacementSprite.y += delY;

                renderer.render(stage);
                if (displacementSprite.x >= 600) {
                    delX = speed;
                } else if (displacementSprite.x <= 0) {
                    delX = -speed;
                }
                if (displacementSprite.y >= 400) {
                    delY = -speed;
                } else if (displacementSprite.Y <= 0) {
                    delY = speed;
                }
            }

        }

        Flag2();

    </script>
</body>

</html>