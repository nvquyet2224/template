<!DOCTYPE html><html lang='en' class=''>
<head>
<meta charset='UTF-8'>
<style>html,body{padding:0;margin:0;width:100%;height:100%;overflow:hidden}
.fill-box{padding:50px}
svg{ margin:5px; border:1px solid #555;display:inline-block;vertical-align:middle}
h2{text-transform:uppercase;margin:0;padding:0}
</style>

</head>
<body>

<div class="fill-box">
<p><a href="http://srufaculty.sru.edu/david.dailey/svg/newstuff/filterDisplacementMap9.svg" target="_blank">http://srufaculty.sru.edu/david.dailey/svg/newstuff/filterDisplacementMap9.svg</a></p>

<!--<svg width="300" height="300">
    <defs>
    <radialGradient id="shap" r=".9"> 
        <stop offset="0%" stop-color="#f00"></stop>
        <stop offset="10%" stop-color="#000"></stop>
        <stop offset="20%" stop-color="#f00"></stop>
        <stop offset="30%" stop-color="#000"></stop>
        <stop offset="40%" stop-color="#f00"></stop>
        <stop offset="50%" stop-color="#000"></stop>
        <stop offset="60%" stop-color="#f00"></stop>
        <stop offset="70%" stop-color="#000"></stop>
        <stop offset="80%" stop-color="#f00"></stop>
        <stop offset="90%" stop-color="#000"></stop> 
        <stop offset="100%" stop-color="#f00"></stop>
    </radialGradient>
    
    <rect id="witness" width="300" height="300" fill="url(#myGra)"></rect>
    
    <filter id="myFill" primitiveUnits="objectBoundingBox">
        <feImage id="mainImg" result="pict2" xlink:href=""></feImage> 
        <feDisplacementMap scale"0.5" xChannelSelector="R" yChannelSelector="G" in2="pict2" in="SourceGraphic"></feDisplacementMap>
    </filter>
    
    </defs>
    

    <use xlink:href ="#witness" />
    
</svg>-->
<h2>Filter with feImage</h2>
<svg width="300" height="300">
	<defs>
        <filter id="wave" primitiveUnits="objectBoundingBox">
            <feImage id="waveShap" result="pict2" xlink:href=""></feImage>
            <feDisplacementMap scale=".01" xChannelSelector="R" yChannelSelector="R" in2="pict2" in="SourceGraphic"></feDisplacementMap>
        </filter>
    </defs>
	<image id="bg" xlink:href="images/beagle400.jpg" width="300" height="300" filter="url(#wave)"></image>
</svg>

</div>

<script>
	var xlink = "http://www.w3.org/1999/xlink";
	var waveShap = document.querySelector("#waveShap");
	var displacement = 0;
	var speed = 0.2;

	function setXlinkHref() {
		  
		  let xlinkHref =
			"data:image/svg+xml;utf8,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='300' height='300'%3E%3Cdefs%3E%3CradialGradient id='rg' r='.9'%3E";
		  for (var i = 0; i < 11; i++) {
			xlinkHref += `%3Cstop 
						offset='${(i - 2) * 10 + displacement}%25' 
						stop%2Dcolor='%23${i % 2 == 0 ? "f00" : "000"}'%3E%3C/stop%3E`;
		  }
		
		  xlinkHref +=
			"%3C/radialGradient%3E%3C/defs%3E%3Crect id='witness' width='300' height='300' fill='url(%23rg)'%3E%3C/rect%3E%3C/svg%3E";

		
		  return xlinkHref;
	}

	function AnimateOffset() {
		
		var xlinkHref = setXlinkHref();
		waveShap.setAttributeNS(xlink, "href", xlinkHref);
		
		if (displacement <= 20) {
			displacement += speed;
		} else {
			displacement = 0;
		}
		//window.requestAnimationFrame(AnimateOffset);
	}
	
	window.requestAnimationFrame(AnimateOffset);
	
</script>

</body>
</html>